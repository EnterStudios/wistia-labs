// Generated by CoffeeScript 1.6.2
var VideoInEmail,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

VideoInEmail = (function() {
  function VideoInEmail() {
    this.outputVideoCode = __bind(this.outputVideoCode, this);
    this.updateVideoCode = __bind(this.updateVideoCode, this);
    this.updatePreview = __bind(this.updatePreview, this);
    this.updateOutputEmbedCode = __bind(this.updateOutputEmbedCode, this);
    var _this = this;
    this.previewEmbedded = false;
    this.change = false;
    this.exampleEmbedCode = "<div id=\"wistia_n9err1v2yk\" class=\"wistia_embed\" style=\"width:640px;height:388px;\"><div itemprop=\"video\" itemscope itemtype=\"http://schema.org/VideoObject\"><meta itemprop=\"name\" content=\"Choosing Background Music - ReelSEO\" /><meta itemprop=\"duration\" content=\"PT4M31S\" /><meta itemprop=\"thumbnailUrl\" content=\"https://embed-ssl.wistia.com/deliveries/e11ab8bcf30ddcef5f2b2a12c4b038613ac4dd84.bin\" /><meta itemprop=\"contentURL\" content=\"https://embed-ssl.wistia.com/deliveries/f33c77c9db099d06d53074d2f31db5ffab62a074.bin\" /><meta itemprop=\"embedURL\" content=\"https://embed-ssl.wistia.com/flash/embed_player_v2.0.swf?2013-10-04&autoPlay=false&banner=false&controlsVisibleOnLoad=false&customColor=87d452&endVideoBehavior=default&fullscreenDisabled=true&hdUrl%5B2pass%5D=true&hdUrl%5Bext%5D=flv&hdUrl%5Bheight%5D=720&hdUrl%5Bsize%5D=89418647&hdUrl%5Btype%5D=hdflv&hdUrl%5Burl%5D=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2F7a18aef53682b02d48ef5caa54e36b35e87f44fd.bin&hdUrl%5Bwidth%5D=1280&mediaDuration=271.0&playButtonVisible=true&showPlayButton=true&showPlaybar=true&showVolume=true&stillUrl=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2Fe11ab8bcf30ddcef5f2b2a12c4b038613ac4dd84.jpg%3Fimage_crop_resized%3D640x360&unbufferedSeek=false&videoUrl=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2Ff33c77c9db099d06d53074d2f31db5ffab62a074.bin\" /><meta itemprop=\"uploadDate\" content=\"2014-02-27T16:15:27Z\" /><object id=\"wistia_n9err1v2yk_seo\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" style=\"display:block;height:360px;position:relative;width:640px;\"><param name=\"movie\" value=\"https://embed-ssl.wistia.com/flash/embed_player_v2.0.swf?2013-10-04\"></param><param name=\"allowfullscreen\" value=\"true\"></param><param name=\"allowscriptaccess\" value=\"always\"></param><param name=\"bgcolor\" value=\"#000000\"></param><param name=\"wmode\" value=\"opaque\"></param><param name=\"flashvars\" value=\"autoPlay=false&banner=false&controlsVisibleOnLoad=false&customColor=87d452&endVideoBehavior=default&fullscreenDisabled=true&hdUrl%5B2pass%5D=true&hdUrl%5Bext%5D=flv&hdUrl%5Bheight%5D=720&hdUrl%5Bsize%5D=89418647&hdUrl%5Btype%5D=hdflv&hdUrl%5Burl%5D=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2F7a18aef53682b02d48ef5caa54e36b35e87f44fd.bin&hdUrl%5Bwidth%5D=1280&mediaDuration=271.0&playButtonVisible=true&showPlayButton=true&showPlaybar=true&showVolume=true&stillUrl=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2Fe11ab8bcf30ddcef5f2b2a12c4b038613ac4dd84.jpg%3Fimage_crop_resized%3D640x360&unbufferedSeek=false&videoUrl=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2Ff33c77c9db099d06d53074d2f31db5ffab62a074.bin\"></param><embed src=\"https://embed-ssl.wistia.com/flash/embed_player_v2.0.swf?2013-10-04\" allowfullscreen=\"true\" allowscriptaccess=\"always\" bgcolor=#000000 flashvars=\"autoPlay=false&banner=false&controlsVisibleOnLoad=false&customColor=87d452&endVideoBehavior=default&fullscreenDisabled=true&hdUrl%5B2pass%5D=true&hdUrl%5Bext%5D=flv&hdUrl%5Bheight%5D=720&hdUrl%5Bsize%5D=89418647&hdUrl%5Btype%5D=hdflv&hdUrl%5Burl%5D=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2F7a18aef53682b02d48ef5caa54e36b35e87f44fd.bin&hdUrl%5Bwidth%5D=1280&mediaDuration=271.0&playButtonVisible=true&showPlayButton=true&showPlaybar=true&showVolume=true&stillUrl=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2Fe11ab8bcf30ddcef5f2b2a12c4b038613ac4dd84.jpg%3Fimage_crop_resized%3D640x360&unbufferedSeek=false&videoUrl=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2Ff33c77c9db099d06d53074d2f31db5ffab62a074.bin\" name=\"wistia_n9err1v2yk_html\" style=\"display:block;height:100%;position:relative;width:100%;\" type=\"application/x-shockwave-flash\" wmode=\"opaque\"></embed></object><noscript itemprop=\"description\">Choosing Background Music - ReelSEO</noscript></div></div>\n  <script charset=\"ISO-8859-1\" src=\"//fast.wistia.com/assets/external/E-v1.js\"></script>\n  <script>\n  wistiaEmbed = Wistia.embed(\"n9err1v2yk\", {\n    videoFoam: true\n  })\n  </script>\n  <script charset=\"ISO-8859-1\" src=\"//fast.wistia.com/embed/medias/n9err1v2yk/metadata.js\"></script>";
    $("#source_embed_code").on("keyup", function() {
      _this.previewEmbedded = false;
      _this.change = false;
      return _this.debounceUpdates();
    });
    $("#video_width").on("keyup", function() {
      _this.previewEmbedded = false;
      _this.change = false;
      return _this.debounceUpdates();
    });
    $("#fallback_link").on("keyup", function() {
      _this.previewEmbedded = false;
      _this.change = false;
      return _this.debounceUpdates();
    });
    $("a[name=remove_all]").on('click', function(e) {
      e.preventDefault();
      return _this.clearAll();
    });
    $("a[name=see_example]").on('click', function(e) {
      e.preventDefault();
      return _this.setupExample();
    });
    $("a[name=reset]").on('click', function(e) {
      e.preventDefault();
      _this.change = false;
      _this.previewEmbedded = false;
      return _this.debounceUpdates();
    });
    $("#configure input[type=number]").on("change", function() {
      _this.change = true;
      return _this.debounceUpdates();
    });
    $("#configure input[type=radio]").on("change", function() {
      _this.change = true;
      return _this.debounceUpdates();
    });
    $("#configure textarea").on("change", function() {
      _this.change = true;
      return _this.debounceUpdates();
    });
  }

  VideoInEmail.prototype.setupExample = function() {
    $("#source_embed_code").val(this.exampleEmbedCode);
    $("#video_width").val(500);
    $("#fallback_link").val("http://i.imgur.com/Y9xpLA6.jpg");
    this.previewEmbedded = false;
    this.change = false;
    return this.debounceUpdates();
  };

  VideoInEmail.prototype.clearAll = function() {
    $("#source_embed_code").val("");
    this.previewEmbedded = false;
    this.change = false;
    return this.debounceUpdates();
  };

  VideoInEmail.prototype.debounceUpdates = function() {
    var updateOutputTimeout;
    clearTimeout("updateOutputTimeout");
    return updateOutputTimeout = setTimeout(this.updateOutputEmbedCode, 100);
  };

  VideoInEmail.prototype.updateOutputEmbedCode = function() {
    this.sourceEmbedCode = Wistia.EmbedCode.parse($("#source_embed_code").val());
    this.outputEmbedCode = Wistia.EmbedCode.parse($("#source_embed_code").val());
    if (this.sourceEmbedCode && this.sourceEmbedCode.isValid()) {
      this.width = this.getVideoWidth();
      $("#output_embed_code").val(this.outputEmbedCode.toString());
      this.updatePreview();
      return this.updateVideoCode();
    } else {
      $("#output_embed_code").val("Please enter a valid Wistia embed code.");
      return $("#preview").html("<div id=\"placeholder_preview\">Your video here</div>");
    }
  };

  VideoInEmail.prototype.updatePreview = function() {
    var _this = this;
    return Wistia.timeout("updatePreview", function() {
      if (_this.change) {

      } else if (!_this.previewEmbedded) {
        return _this.outputEmbedCode.previewInElem("preview", {
          type: "api"
        }, function() {
          return _this.previewEmbedded = true;
        });
      }
    }, 100);
  };

  VideoInEmail.prototype.updateVideoCode = function() {
    var _this = this;
    Wistia.timeout("updateVideoCode", function() {
      var styles;
      $('#video_code').val(_this.outputVideoCode());
      styles = {
        height: '112px',
        width: '585px',
        'font-family': 'Courier'
      };
      return $('#video_code').css(styles);
    }, 100);
    Wistia.hashedId = Wistia.EmbedCode.parse($("#source_embed_code").val()).hashedId();
    return Wistia.remote.media("" + Wistia.hashedId, function(media) {
      return Wistia.mp4Url = media.assets.iphone.url.replace('.bin', '/video.mp4');
    });
  };

  VideoInEmail.prototype.outputVideoCode = function() {
    return "<video width=\"" + (this.getVideoWidth()) + "\" height=\"360\" poster=\"" + (this.getFallbackLink()) + "\" controls=\"controls\">\n  <source src=\"" + (this.getVideoMp4()) + "\" type=\"video/mp4\" />\n  <a href=\"" + (this.getFallbackLink()) + "\"><img src=\"" + (this.getFallbackLink()) + "\" width=\"640\" height=\"360\" /></a>\n</video>";
  };

  VideoInEmail.prototype.getVideoWidth = function() {
    return parseInt($("#video_width").val());
  };

  VideoInEmail.prototype.getFallbackLink = function() {
    return $("#fallback_link").val();
  };

  VideoInEmail.prototype.getVideoMp4 = function() {
    return Wistia.mp4Url;
  };

  return VideoInEmail;

})();

window.setupLabInterface = function($) {
  return $(function() {
    window.videoInEmail = new VideoInEmail();
    if (!Wistia.localStorage("videoInEmail.cleared")) {
      showExample();
      $(".show_example_text").hide();
      $(".clear_example_text").show();
    } else {
      $(".show_example_text").show();
      $(".clear_example_text").hide();
    }
    $("#clear_example").click(function(event) {
      event.preventDefault();
      resetInterface();
      $(".show_example_text").show();
      $(".clear_example_text").hide();
      return Wistia.localStorage("videoInEmail.cleared", true);
    });
    return $("#show_example").click(function(event) {
      event.preventDefault();
      showExample();
      $(".show_example_text").hide();
      $(".clear_example_text").show();
      return Wistia.localStorage("videoInEmail.cleared", false);
    });
  });
};

window.resetInterface = function() {
  return videoInEmail.clearAll();
};

window.showExample = function() {
  return videoInEmail.setupExample();
};

setupLabInterface(jQuery);
